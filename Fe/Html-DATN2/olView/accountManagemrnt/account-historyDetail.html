


<section style="margin-top: 82px;" class="container-fluid" ng-init="showBillDetail()" >
    <div style="display: flex;justify-content: center;">
        <div class="category-container">
          <div class="heading-data__title" id="headingTitle">
            DANH MỤC SẢN PHẨM
          </div>
          <div class="category-body">
            <div class="col-md-4">
              <div class="category-data" id="categoryDataContainer">
                <ul >
                <li ng-repeat="category in dataFill.categoryList">
                  <a ng-href="#!product?categoryId={{category.id}}" class="text-dark">{{category.name}}</a>
                </li>
                </ul>
              </div>
            </div>
            <button class="btn btn-primary" ng-click="goToOfView()" ng-show="isAdmin">Chức năng Admin</button>
          </div>
      
      
          <div class=" d-flex justify-content-start" style="width: 32%;">
            <div style=" border-radius: 10px;    width: 100%;" class="input-group">
              <div class="form-outline">
                <input style="border-bottom: 1px solid #cdcdcd;" type="search" ng-click="openOverlaySearch()" 
                  class="form-control" readonly />
                <label class="form-label">Tìm kiếm sản phẩm</label>
              </div>
              <button type="button" class="btn btn-primary shadow-0" onclick="openOverlay()">
                <i class="fas fa-search fa-lg"></i>
              </button>
      
            </div>
          </div>
        </div>
      </div>
    
      <div class="overlay" id="overlay" class="inactive" ng-click="closeOverlay($event)">
        <div class="header-search">
          <button type="button" class="btn btn-light shadow-0 closeBtn" ng-click="toggleOverlaySearch()">
            <i class="fa-solid fa-xmark fa-lg"></i>
          </button>
          <form class="from-search"  >
            <div class="input-group">
              <div class="form-outline w-100">
              <input style="border-bottom: 1px solid #cdcdcd;" type="search" id="form1" class="form-control"
        ng-model="searchText" ng-change="loadProductSearch()" />
    
    
              </div>
              <button type="button" class="btn btn-primary shadow-0">
                <i class="fas fa-search"></i>
              </button>
            </div>
          </form>
        </div>
        <div class="product-display">
          <div class="container-fluid">
            <div  class="row" id="productDisplay">
            </div>
          </div>
        </div>
      </div>
      
    <div style="margin-bottom: 40px;padding: 46px 64px;" class="row">
        <div class="col-lg-3 col-md-6 col-sm-6 mb-4">

            <div class="account-page-title">
                <span>Tài khoản của bạn</span>
            </div>


            <div class="collapsible-account-content">
                <div class="block-title">
                    <strong class="customer-name">{{userData.fullName}}</strong>
                </div>
                <div class="block-content block-collapsible-nav-content">
     
    
     
                    <ul class="nav items">
                        <li class="nav item current"><a href="#!account-info">Thông tin tài khoản</a></li>
                    </ul>
                    <ul ng-if="!isAdmin" class="nav items">
                        <li class="nav item current"><a href="#!account-history"><strong>Lịch sử mua hàng</strong> </a></li>
                    </ul>
                    <ul ng-if="!isAdmin" class="nav items">
                        <li class="nav item current"><a href="#!account-address">Sổ địa chỉ</a></li>
                    </ul>
                    <ul ng-if="!isAdmin" class="nav items">
                        <li class="nav item current"><a href="#!account-favorite">Sản phẩm yêu thích</a></li>
                    </ul>
                    <ul ng-if="!isAdmin" class="nav items"><li class="nav item current"><a href="#!account-evaluate">Đánh giá</a></li>
                    </ul>
                <hr>
    
                <ul class="nav items">
                    <li class="nav item current"><a href=""   ng-click="logout()">Đăng xuất</a></li>
                </ul>
                </div>
            </div>
      
        </div>
        <div class="col-lg-9 col-md-6 col-sm-6 mb-4">
            <div class="column-main">
                <div class="page-title-wrapper">
                    <h1 class="page-title">
                        <span class="base">Thông tin chi tiết</span>
                    </h1>
                </div>
                
                <div class="row">
                    <div class="col-md-12">
                        <table class="table">
                            <tr>
                                <td>
                                    <table class="table">
                                        <tr>
                                            <td>Mã hóa đơn:</td>
                                            <td>{{ selectedBill.code }}</td>
                                            <td>Trạng thái thanh toán:</td>
                                            <td><strong>{{getStatusText(selectedBill.status) }}</strong></td>
                                            <td>
                                        </tr>
                                        <tr>
                                            <td>Ngày tạo:</td>
                                            <td>{{ selectedBill.createdAt | date:'HH:mm - dd/MM/yyyy' }}</td>
                                            <td>Phương thức thanh toán:</td>
                                            <td>{{ selectedBill.paymentMethod.name }}</td>
                                        </tr>
                                        <tr>
                                            <td>Ngày thanh toán:</td>
                                            <td>{{ selectedBill.paymentDate | date:' HH:mm - dd/MM/yyyy ' }}</td>

                                            <td>Địa chỉ:</td>
                                            <td>{{ selectedBill.address }}</td>
                                        </tr>
                                        <tr>
                                            <td>Ngày giao hàng:</td>
                                            <td>{{ selectedBill.deliveryDate | date:'HH:mm - dd/MM/yyyy' }}</td>
                                            <td>Số điện thoại:</td>
                                            <td>{{ selectedBill.phoneNumber }}</td>
                                        </tr>
                                        <tr>
                                            <td>Phí vận chuyển:</td>
                                            <td>{{ selectedBill.shippingFee | number}} đ</td>
                                            <td>Mã giảm giá:</td>
                                            <td>{{ selectedBill.voucher.code }}</td>
                                        </tr>
                                        <tr>
                                            <td>Ghi chú:</td>
                                            <td>{{ selectedBill.note }}</td>
                                           
                                                
                                        </tr>
                                      
                                    </table>
                                </td>
                            </tr>
                        </table>
                    </div>
                </div>
                
                <div class="row">
                    <div class="col-md-12">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>STT</th>
                                    <th>Tên sản phẩm</th>
                                    <th>Số lượng</th>
                                    <!-- <th>Đơn giá</th> -->
                                    <th>Giá bán</th>
                                    <th>Thành tiền</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr ng-repeat="detail in selectedBill.billDetail">
                                    <td>{{$index + 1}}</td>
                                    <td>{{ detail.productDetail.product.name }}</td>
                                    <td>{{ detail.quantity }}</td>
                                    <td>{{ detail.productDetail.price | number}} đ</td>
                                    <!-- <td>{{ detail.productDetail.price - detail.discount }}</td> -->
                                    <td>{{ detail.quantity * (detail.productDetail.price - detail.discount) | number}} đ</td>
                                    <td ng-if="selectedBill.status == 3 && !detail.rated">
                                        <button class="btn btn-primary" ng-click="openReview(detail)">Đánh giá</button>
                                      </td>
                                      
                                    </td>
                                
                                        <!-- Modal -->
                                    <div class="modal fade show" id="reviewModal" tabindex="-1" role="dialog" aria-labelledby="reviewModalLabel" aria-hidden="true">
                                        <div class="modal-dialog" role="document">
                                            <div class="modal-content">
                                                <div class="modal-header">
                                                    <h5 class="modal-title" id="reviewModalLabel">Đánh giá sản phẩm</h5>
                                   
                                                </div>
                                                <div class="modal-body">
                                                    <div class="star-container">
                                                        <span class="fa fa-star" ng-click="toggleStars(0)"></span>
                                                        <span class="fa fa-star" ng-click="toggleStars(1)"></span>
                                                        <span class="fa fa-star" ng-click="toggleStars(2)"></span>
                                                        <span class="fa fa-star" ng-click="toggleStars(3)"></span>
                                                        <span class="fa fa-star" ng-click="toggleStars(4)"></span>
                                                    </div>
                                                    
                                                      
                                                    <textarea ng-model="rating.content" rows="4" cols="50" placeholder="Nhập nội dung đánh giá..."></textarea>
                                                </div>
                                                <div class="modal-footer">
                                                    <button type="button" class="btn btn-secondary" ng-click="closeReview()">Đóng</button>

                                                    <button type="button" class="btn btn-primary" ng-click="addRating()">Đánh giá</button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                 
                </div>
                <div class="row" style="    display: flex;
                justify-content: flex-end;">
                    <div class="col-md-4">
                        <table class="table">
                            <!-- Thêm một hàng mới hiển thị các thông tin tổng hợp -->
                            <footer>
                                <tr>
                                    <td><strong>Tổng tiền hàng:</strong></td>
                                    <td class="text-right">{{ (selectedBill.totalAmount) | number }} đ</td>
                                </tr> 
                                <tr>
                                    <td><strong>Giảm giá hóa đơn:</strong></td>
                                    <td class="text-right">{{ selectedBill.totalAmount - (selectedBill.totalAmountAfterDiscount)  | number }}  đ</td>
                                </tr>
                                <tr>
                                    <td><strong>Khách phải trả:</strong></td>
                                    <td class="text-right">{{ (selectedBill.totalAmountAfterDiscount + selectedBill.shippingFee| number)  }} đ</td>
                                </tr>
                            </footer>
                        </table>
                    </div>
                </div>

                <div style="justify-content: flex-end;
                display: flex;" ng-if="selectedBill.status === 1 && selectedBill.paymentMethod.name === 'COD'">
                    <button ng-click="updateBillStatus(selectedBill.id)" class="btn btn-danger">Hủy đơn hàng</button>
                  </div>
                
            </div>
        </div>
        
        
    </div>

</section>
